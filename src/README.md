# 開發代碼規範

通過閱讀當前文件，你將知道如何在現有的工作成果上進一步開發。

## 確保 Chisel 生成代碼的可讀性

* 将关键信号的运算封装到模块中而不是使用函数def.这是由于chisel在编译过程中，会将函数拆解，产生大量的临时变量名。
可以使用伴生对象和工厂函数实现与普通函数相同的功能。
* 命名信号时使用驼峰法.
这是由于chisel中的"." 在生成时会被转译成“_”，因此在chisel代码中大量使用 "_" 来命名信号的话会造成Verilog代码不明显，不容易搜到。
* 所有的chisel中命名的信号的名字都会保留在Verilog中，将连续的运算拆分成多个可以减少Verilog代码中中间变量的数目，增加可读性。
* .reduce(_||_) 函数会在Verilog中生成大量的或运算；使用 in.orR()，会在Verilog中调用 |in ，如果in的类型是 Seq[Bool]，可以使用 Vecinit(in).asUInt().orR() 将其转换为UInt类型然后再调用orR。

## 確保 Chisel 代碼與架構的可讀性

* 設計良好的目錄結構，通常劃分的方式爲：
  * 參數-常量
  * ISA相關-ISA無關
  * 架構相關-架構無關
  * 流水間單元、功能單元、基本運算單元
* 文件格式
  * 建議: 在可以的情況下，保證一行的代碼不超過72個西元字母（標準終端寬度爲80）
  * 建議: 在可以的情況下，每一個文件應當控制在300行以內。
  * 要求: 每一個文件應當僅僅提供一個或一小類服務。
* 目錄劃分：
  * 要求: 每一個較爲獨立的服務應當通過一個目錄存放，打包到一個包中。
  * 要求: 保證打包邏輯與目錄結構相對應。
  * 建議: 一個目錄下不應當超過10個獨立文件，且存在其他子目錄。
    * 這一條是要確保每一個無子目錄的目錄都應該提供一個服務，而不是部分服務位於父目錄，部分位於子目錄。
    * 除非父目錄中提供了子目錄所必須的公共服務。
* README:
  * 要求: 每一個提供一定量服務的目錄都應當配備一個內容翔實的README.
  * 要求: 每一個README中至少應該包含：
    * 當前開發狀態
    * 目錄設計思路
    * 已知問題、可能問題
    * 單元測試情況
  * 建議: 可以視情況包含如下內容
    * 未來開發建議

## 特殊情況

較爲早期的代碼可能不符合上述要求，但是正在改善。
